<!DOCTYPE html>
<html lang="en">
<head>
    <script src="./products_data.js" type="text/javascript"></script>
    <link href="products-style.css" rel="stylesheet">
    <script>
        // get querystring data
        var params = (new URL(document.location)).searchParams;
        // execute function when on window load
        window.onload=function(){
        // if errors, go get errors and quantities and display them
        if(params.has("errorsJSONstring")){
            var errorsObject = JSON.parse(params.get("errorsJSONstring"));
        // check if there are no selections
            if(typeof errorsObject["noQty"] != "undefined"){
                alert(errorsObject["noQty"]);
            } else {
                // alert if any errors
                alert('Invalid quantities!')
        // put quantities back in textboxes 
                for(let i in products){
                    qtyForm[`quantity${i}`].value=params.get(`quantity${i}`);
                    // handle invalid quantity
                    if(typeof errorsObject[`quantity${i}_error`] != "undefined"){
                        document.getElementById(`quantity${i}_span`).innerHTML = errorsObject[`quantity${i}_error`];
                    }
                    // handle qty not available 
                    else if(typeof errorsObject[`quantity${i}_available_error`] != "undefined"){
                        document.getElementById(`quantity${i}_span`).innerHTML = errorsObject[`quantity${i}_available_error`];
                    // IR 3: make textbox red, set value to quantity available
                        qtyForm[`quantity${i}`].value = products[i].quantity_available;
                        qtyForm[`quantity${i}`].style.border = "2px solid red";
                        qtyForm[`quantity${i}`].style.borderRadius = "5px";
                    }
                }
            }
        }
    }
    </script>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHINee Album Shop</title>

</head>

<body>
    <h1>SHINee Album Shop</h1>
    <div>
        <main>
            <form id= "qtyForm" action="./purchase" method="POST">
            <script>
                // loop through 
                for(i = 0; i < products.length; i++)
                    {document.write(`
                        <section class="item">
                        <h2>${products[i].album}</h2>
                        <p>&dollar;${products[i].price}</p>
                        <img src ="./images/${products[i].image}">
                        <h3>In stock: ${products[i].quantity_available}</h3>
                        <label id="quantity${i}_label">Quantity Desired:</label>
                        <input type="text" id="quantity${i}_id" placeholder="0" name="quantity${i}">
                        <br>
                        <span id="quantity${i}_span"></span>
                        </section>
                     `)}
             </script>
            </main>
        </div>
    <footer>
        <input type="submit" class="rounded-button" id="purchase_button" value="Purchase">
    </footer>
</body>
</form>
</html>