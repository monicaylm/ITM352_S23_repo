<!-- Author: Tina Vo -->
<!-- Date: 11/18/2021 -->
<!-- Products Page -->

<script src="./product_data.js" type="text/javascript"></script>
<script src="./navigation.js" type="text/javascript"></script>
<script type="text/javascript">navigationbar();</script>

<!-- This file loads the order page with products, prices, and quantity -->

<script>

    // function altered from assignment1_2file
    // checks if a string q is a non negative integer. 
    function isNonNegInt(q, returnErrors = false) {
        errors = []; // assume no errors at first
        if (q == '') q = 0; //don't show anything if txt box is blank
        if (Number(q) != q) errors.push('<font color="brightpink">Not a number!</font>'); // check if string is a number value
        else {
            if (q < 0) errors.push('<font color="brightpink">Negative value!</font>'); // check if it is non-negative
            if (parseInt(q) != q) errors.push('<font color="brightpink">Not an integer!</font>'); // check that it is an integer
            if (q > 10) errors.push('<font color="brightpink">Not available</font>');

        }
        return returnErrors ? errors : (errors.length == 0);
    }

    // is the textbox value a non-negative integer?
    // function is from lab 12, modified for assignment 1
    function checkQuantityTextbox(theTextbox) {
        var errors_invalid = isNonNegInt(theTextbox.value, true);
        //  if no errors -> change msg
        if (errors_invalid.length == 0) errors_invalid = ['Quantity desired'];
        // if box is empty, enter quantity
        if (theTextbox.value.trim() == '') errors_invalid = ['Insert quantity'];
        // if errors, show all errors
        document.getElementById(theTextbox.name + '_label').innerHTML = errors_invalid.join(", ");
    }

</script>

<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, 
    <link rel=" preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Be+Vietnam+Pro:wght@100&family=Dancing+Script&family=Didact+Gothic&family=Nixie+One&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="./navigation.css">
    <title>Stationery Store</title>
    <link rel="stylesheet" href="./products-style.css">
    <script src="./product_data.js" type="text/javascript"></script>


</head>

<body>

    <center>
        <div class="title">

            <img src="./images/window.png" style="width:110px; height:110px">
            <h1 id="tinastext">Tina's Stationery</h1>

        </div>
    </center>



    <body>
        <!--The form for purchasing begins here-->
        <form name="product_form" action="./purchase" method="POST">


            <div>
                <main>
                    <script>
                        //setting up the form with for statement
                        //load the product information into the order page with for loop
                        for (i in products_array) {
                            document.write(`
                            <div class="product_items">
                                <img src="${products_array[i].image}">
                                <div class="description">
                                    <br>
                                <h2 id="product_names">${products_array[i].name}</h2>
                                <p>$${products_array[i].price}</p>
                                <p>Items Available: ${products_array[i].quantity_available}</p>
                                <label id="quantity${i}_label"}">Quantity</label>
                                <input type="text" placeholder="0" name="quantity${i}" onkeyup="checkQuantityTextbox(this);"></input>
                                
                                <br>
                                <br>
                            </div>
                            
                        </div>
                        `);
                        }




                    </script>
                    <footer>
                        <input type="submit" value="Purchase" name="checkout_button" id="checkout_button">
                    </footer>
                   

                    <script>
                        //display alert as a response when for loops from server.js are executed depending on the quantity inserted
                        window.onload = function () {
                            let params = (new URL(document.location)).searchParams;
                            //if errorMessage is in qry string then put up alert with error message
                            if (params.has("errorMessage")) {
                                alert(params.get("errorMessage"));
                            }
                            // make textboxes sticky for invalid data
                            for (i = 0; i < products_array.length; i++) {
                                if (params.has(`quantity${i}`)) {
                                    quantity_input = params.get(`quantity${i}`);
                                    product_form[`quantity${i}`].value = quantity_input;
                                    // shows where the error is
                                    checkQuantityTextbox(product_form[`quantity${i}`]); 
                                }
                            }
                        }

                    </script>
                </main>



            </div>
            <br>

        </form>

    </body>


</html>