<!--- Description 
Author: Zenan Li & Kai Lin
Date: May 13th, 2022
Description: This is the register page to register new users who don't have an account
----->
<!DOCTYPE html>
<html lang="en">
<head>
  <title>User Registration</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="/register.css">
  <style>
    /* Remove the navbar's default rounded borders and increase the bottom margin */ 
    .navbar {
      margin-bottom: 50px;
      border-radius: 0;
      overflow: hidden;
      font-family: Arial, Helvetica, sans-serif;
    }

    .navbar a {
    float: left;
    color: white;
    text-align: center;
    text-decoration: none;
    }
    
    /* Remove the jumbotron's default bottom margin */ 
    .jumbotron {
      margin-bottom: 0;
    }
   
    /* Add a gray background color and some padding to the footer */
    footer {
      background-color: #f2f2f2;
      padding: 25px;
    }
  </style>
  <script>
    let params = (new URL(document.location)).searchParams;
    window.onload = () => {
      console.log("onload")
      if (params.has('email')) {
          email.value = params.get('email');//make email sticky
          params.delete('email')
      }
      if (params.has('username')) {
          username.value = params.get('username');//make username sticky
          params.delete('username')
      }
      if (params.has('reg_error_string')) { 
      alert('Please fix errors');
          errors = JSON.parse(params.get('reg_error_string'));
          params.delete('reg_error_string')
      }
      for(textbox_id in errors) {
          document.getElementById(textbox_id).innerHTML = errors[textbox_id];
      }
    }

  </script>

<script src="./functions.js"></script> 
<script>
//Variables for Nav Bar
var this_product_key = loadJSON('products_key');

var products_array;
loadJSON('get_products_data', function(response) {
  // Parsing JSON string into object
  products_array = JSON.parse(response);
});

//Variable for the User Info to display user's name
  var uinfo;
  loadJSON('get_user_info', function(response) {
  // Parsing JSON string into object
  uinfo = JSON.parse(response);
});

  //Variable for the # of total items in cart
var cart_amount;
    loadJSON('./get_cart_data', function (response) {
        // Parsing JSON string into object
        cart_amount = JSON.parse(response);
    });
</script>
</head>

<body>
<div class="jumbotron">
  <div class="container1 - text-center">
    <h1>Zenan's Sport's Shop</h1>      
    <p>Mission, Vision & Values</p>
  </div>
</div>
<!-- Start of the Nav Bar-->
<nav class="navbar navbar-inverse">
  <div class="container-fluid1">
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav">
        <li><a href="index.html">Home</a></li>
        <!-- Displays the different products pages-->
          <script>
            nav_bar(this_product_key, products_array);
          </script>
        <li><a href="contact.html">Contact</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
         <!--Displays Sign in page if the user is logged in or logout button with their name is signed in -->
        <script>
          if (uinfo.username == "Your Account")
          document.write(`<li><a href="login.html"><span class="glyphicon glyphicon-user"></span>Sign In</a></li>`)

          else
            document.write(`
            <li><a href="/logout"> <span class="glyphicon glyphicon-user"></span>Logout ${uinfo.username}</a></li>
            `);
          
        </script>
        <li><a href="update.html"><span class="glyphicon glyphicon-user"></span>Update Acccount</a></li>
        <li><a href="register.html"><span class="glyphicon glyphicon-user"></span>Register</a></li>
          <!-- Links to the shopping cart page but also displays a shopping cat image with total number of items in the cart -->
        <li><a href="invoice.html"><span class="glyphicon glyphicon-shopping-cart"></span>Cart(<script>document.write(cart_total(cart_amount))</script>)</a>)
      </ul>
    </div>
  </div>
</nav>

<script>
  document.write(`<form name="register_form" action="/register?${params.toString()}" method="POST">`)
</script>
<!--Form that allows people to register. Invalid info will show up as red text under the textboxes when the submit-->
<form name="register_form" action="/register" method="POST">
<section class="register">
<div class = "sign_up">
  <label>Sign Up</label>
</div>
  <br>
  <br>
<div class="register_form">
  <label for="name">Full Name</label>
  <br>
  <input type="text" placeholder="Enter" name="username" pattern=".*[A-Za-z]" title="Name must only contain letters">
  <b>
  <div id = 'username' style="color: red" ></div>
  </b>
  <br>
  <br>
  <label for="email">Email:</label>
  <br>
  <input type="text" placeholder="Enter" name="email">
  <b>
  <div id = 'email' style="color: red"></div>
  </b>
  <br>
  <br>
  <label for="password">Password:</label>
  <br>
  <input type="password" placeholder="Enter" name="password" title="Must be at least 8 characters long">
  <b>
  <div id = 'password' style="color: red"></div>
  </b>
  <br>
  <br>
  <label for="repeat password">Verify Password:</label>
  <br>
  <input type="password" placeholder="Enter" name="password2" title="Must be at least 8 characters long">
  <b>
  <div id = 'password2' style="color: red" ></div>
  </b>
  <br>
  <br>
  <div class="register">
  <input type="submit" name="register" value="Register" action ="invoice.html">
  </div>
</div>
</form>
  <br>
  <br>
  <br>
  <br>

<!-- Takes them to page to update their information-->
<div class="update">
  Make changes to your account?<br>
  <script>
    document.write(`<input type="button" value="Update" onclick='location.href="./update.html?${params.toString()}"'>`)
  </script>
</div>
  <br>

  <!-- Takes them to page to sign in if they have an account-->
<div class="login">
  Logging in to your account?<br>
  <script>
    document.write(`<input type="button" value="Login" onclick='location.href="./login.html?${params.toString()}"'>`)
  </script>
</div>
</body>
</html>
<br>
<br>
<br>
<br>

<footer class="container-fluid2 text-center">
  <p>
    <b><span>&#169;</span>Zenan's Sport's Shop 2022</b>
  </p>  
  <form class="form-inline"><b>Get deals:</b>
    <input type="email" class="form-control" size="50" placeholder="Email Address">
    <button type="button" class="btn btn-danger"><b>Sign Up</b></button>
  </form>
</footer>