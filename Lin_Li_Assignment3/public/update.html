<!--- Description 
Author: Zenan Li & Kai Lin
Date: May 13th, 2022
Description: This is the update page to update current users' information.
----->
<!DOCTYPE html>
<html lang="en">
<head>
  <title>User Login</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="./update.css">
  <style>
    /* Remove the navbar's default rounded borders and increase the bottom margin */ 
    .navbar {
      margin-bottom: 50px;
      border-radius: 0;
      overflow: hidden;
      font-family: Arial, Helvetica, sans-serif;
    }

    .navbar a {
    float: left;
    color: white;
    text-align: center;
    text-decoration: none;
    }
    
    /* Remove the jumbotron's default bottom margin */ 
    .jumbotron {
      margin-bottom: 0;
    }
   
    /* Add a gray background color and some padding to the footer */
    footer {
      background-color: #f2f2f2;
      padding: 25px;
    }
  </style>
  <script>
    let params = (new URL(document.location)).searchParams;
    window.onload = () => {
      console.log("onload")
      //Continue to attach ordered quantities in the query string
      if (params.has('email')) {
        email.value = params.get('email');//make username sticky
        params.delete('email')
      }
      //Attach error message in the query string
      if (params.has('upd_error_string')) {
        alert(params.get('upd_error_string'));
        params.delete("upd_error_string")
      }
  }
  </script>

<script src="./functions.js"></script> 
<script>
//Variables for Nav Bar
var this_product_key = loadJSON('products_key');

var products_array;
loadJSON('get_products_data', function(response) {
  // Parsing JSON string into object
  products_array = JSON.parse(response);
});

  //Variable for the User Info to display user's name
  var uinfo;
  loadJSON('get_user_info', function(response) {
  // Parsing JSON string into object
  uinfo = JSON.parse(response);
});

  //Variable for the # of total items in cart
var cart_amount;
    loadJSON('./get_cart_data', function (response) {
        // Parsing JSON string into object
        cart_amount = JSON.parse(response);
    });

</script>

</head>

<body>
<div class="jumbotron">
  <div class="container1 - text-center">
    <h1>Zenan's Sport's Shop</h1>      
    <p>Mission, Vision & Values</p>
  </div>
</div>
<!-- Start of the Nav Bar-->
<nav class="navbar navbar-inverse">
  <div class="container-fluid1">
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav">
        <li><a href="index.html">Home</a></li>
          <!-- Displays the different products pages-->
          <script>
            nav_bar(this_product_key, products_array);
          </script>
        <li><a href="contact.html">Contact</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <!--Displays Sign in page if the user is logged in or logout button with their name is signed in -->
        <script>
          if (uinfo.username == "Your Account")
          document.write(`<li><a href="login.html"><span class="glyphicon glyphicon-user"></span>Sign In</a></li>`)

          else
            document.write(`
            <li><a href="/logout"> <span class="glyphicon glyphicon-user"></span>Logout ${uinfo.username}</a></li>
            `);
          
        </script>
        <li><a href="update.html"><span class="glyphicon glyphicon-user"></span>Update Acccount</a></li>
        <li><a href="register.html"><span class="glyphicon glyphicon-user"></span>Register</a></li>
        <!-- Links to the shopping cart page but also displays a shopping cat image with total number of items in the cart -->
        <li><a href="invoice.html"><span class="glyphicon glyphicon-shopping-cart"></span>Cart(<script>document.write(cart_total(cart_amount))</script>)</a>)
      </ul>
    </div>
  </div>
</nav>

<script>
  document.write(`<form name="update_form" action="/update?${params.toString()}" method="POST">`)
</script>

<form name="update_form" action="/update" method="POST">
<!-- Sample login layout taken from https://mdbootstrap.com/docs/standard/extended/login/-->
<script>
  quantities = params.get(`quantities`);
  document.write(`<input type="hidden" name="quantities" id="quantities" value='${quantities}'>`)
</script>
<div class = "update_account">
  <label>Update Your Account Information</label>
</div>
  <br>
  <br>
<div class="update_info">
  <label for = "Full Name">Full Name:</label>
  <br>
  <input type="text" placeholder="Enter" name="username" pattern=".*[A-Za-z]" title="Name must only contain letters">
  <br>
  <br>
  <label for = "Email">Email:</label>
  <br>
  <input type="text" placeholder="Enter" name="email">
  <br>
  <br>
  <label for = "Password">Password:</label>
  <br>
  <input type="password" placeholder="Enter" name="password" title="Must be 6 characters long">
  <br> 
  <br>
  <label for = "Verify Password">Verify Password:</label>
  <br>
  <input type="password" placeholder="Enter" name="password2" title="Must be 6 characters long"></br>
  <br>
  <br>
  <input type="submit" name="Update" value="Update">
</div>
</form>
  <br>
  <br>
  <br>
  <br>

<!-- Takes them to page to make an account-->
<div class="sign_up">
  Don't have an account?<br>
  <script>
    document.write(`<input type="button" value="Sign Up" onclick='location.href="./register.html?${params.toString()}"'>`)
  </script>
</div>
  <br>
  <!-- Takes them to page to sign in if they have an account-->
<div class="login">
  Logging in to your account?<br>
  <script>
  document.write(`<input type="button" value="Login" onclick='location.href="./login.html?${params.toString()}"'>`)
  </script>
</div>
</body>
</html>
<br>
<br>
<br>
<br>

<footer class="container-fluid2 text-center">
  <p>
    <b><span>&#169;</span>Zenan's Sport's Shop 2022</b>
  </p>  
  <form class="form-inline"><b>Get deals:</b>
    <input type="email" class="form-control" size="50" placeholder="Email Address">
    <button type="button" class="btn btn-danger"><b>Sign Up</b></button>
  </form>
</footer>